<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="d3.v7.js"></script>
    <title>CS416 Narrative Visualization</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&family=Rubik:ital,wght@0,400;1,800&display=swap"
        rel="stylesheet">
    <style>
        .bold {
            font-family: 'Roboto', sans-serif;
            font-weight: 400;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <div class="header">
        <a href="index.html"><img src="img/stacks.png" alt="stacked lego icon" width="60" height="auto" class="center"
            style="margin-top:30px; cursor: pointer;"></a>
        <h1>Average exam scores</h1>
        
    </div>

    <p class="center">stuff </p>
    <p class="center">__________</p>
    <p class="center" style="margin-top: 10px; font-weight: 500;">Hover over each bar to see precise quantities.</p>

    <br><br>

    <div id="tooltip">
        <p><span id="value"></span></p>
    </div>

    <div id="$id"></div>

<script type="module">

  (async () => {
    const data = d3.csvParse(`$df`, d3.autoType);

    const margin = { top: 40, right: 40, bottom: 40, left: 40 };
    const [w, h] = [500, 500];

    const svg = d3
      .select('#$id')
      .append('svg')
      .attr('width', w)
      .attr('height', h);

    const g = d3.flatRollup(
      data,
      v => d3.mean(v, d => d['reading score']),
      d => d['gender']
    );

    const xScale = d3.scaleBand(
      g.map(i => i[0]),
      [margin.left, w - margin.right]
    );
    const yMax = Math.ceil(d3.max(g, i => i[1]) / 10) * 10;
    const yScale = d3.scaleLinear([0, yMax], [h - margin.bottom, margin.top]);

    svg
      .append('g')
      .attr('class', 'axis x')
      .attr('transform', `translate(0, ${h - margin.top})`)
      .call(d3.axisBottom(xScale));
    svg
      .append('g')
      .attr('class', 'axis y')
      .attr('transform', `translate(${margin.left}, 0)`)
      .call(d3.axisLeft(yScale).ticks(7));

    const barWidth = 80;
    svg
      .selectAll('rect')
      .data(g)
      .enter()
      .append('rect')
      .attr('width', barWidth)
      .attr('height', d => h - margin.top - yScale(d[1]))
      .attr('x', d => xScale(d[0]) + xScale.bandwidth() / 2 - barWidth / 2)
      .attr('y', d => yScale(d[1]))
      .attr('fill', '#c51b8a')
      .exit()
      .remove();
    svg
      .selectAll('rect')
      .on('mouseenter', function () {
        d3.select(this).transition().duration(300).attr('fill', '#7a0177');
      })
      .on('mouseleave', function () {
        d3.select(this).transition().duration(300).attr('fill', '#c51b8a');
      });

    svg
      .append('text')
      .text('Average `reading score` grouped by `gender`')
      .style('font-family', 'IBM Plex Sans')
      .style('font-weight', 'bold')
      .style('font-size', '1.5rem')
      .attr('x', margin.left / 2)
      .attr('y', margin.top / 2);
    svg
      .append('text')
      .text('Gender')
      .style('font-family', 'IBM Plex Sans')
      .style('font-weight', 'bold')
      .style('font-size', '1.2rem')
      .style('text-anchor', 'middle')
      .attr('x', w / 2)
      .attr('y', h);
    svg
      .append('text')
      .text('Score')
      .style('font-family', 'IBM Plex Sans')
      .style('font-weight', 'bold')
      .style('font-size', '1.2rem')
      .style('text-anchor', 'middle')
      .attr('x', margin.left / 2 - 5)
      .attr('transform', `rotate(-90, ${margin.left / 2 - 5}, ${h / 2})`)
      .attr('y', h / 2);
  })();
</script>
    <p class="center">Stuff</p>

    <br><br>

    <a href="scene2.html" style="text-decoration:none;"><button class="center">Next</button></a>
    <a href="index.html" style="text-decoration:none;"><button class="center"
            style="outline: 2px; outline-color: black; background-color: #0055BF; margin-bottom: 50px;">Back</button></a>

    <br><br><br>
    <div class="footer">
        <h4>Maxwell Wieboldt (mgw10)</h4>
        <h4>Dataset: https://www.kaggle.com/datasets/spscientist/students-performance-in-exams/data</h4>
    </div>

</body>

</html>