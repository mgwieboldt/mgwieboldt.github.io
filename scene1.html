<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="d3.v7.js"></script>
    <title>CS416 Narrative Visualization</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&family=Rubik:ital,wght@0,400;1,800&display=swap"
        rel="stylesheet">
    <style>
        .bold {
            font-family: 'Roboto', sans-serif;
            font-weight: 400;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <h2>Average Math Score grouped by Gender</h2>
    <svg width="600" height="400"></svg>

    <script>
        // Load data from CSV file
        d3.csv("StudentsPerformance.csv").then(function(data) {
            data.forEach(d => {
                d["math score"] = +d["math score"];
            });

            const groupedData = d3.group(data, d => d.gender);
            const avgMathScoreByGender = Array.from(groupedData, ([key, values]) => ({
                gender: key,
                average: d3.mean(values, d => d["math score"])
            }));

            const svg = d3.select("svg");
            const margin = {top: 20, right: 30, bottom: 40, left: 40};
            const width = +svg.attr("width") - margin.left - margin.right;
            const height = +svg.attr("height") - margin.top - margin.bottom;
            const g = svg.append("g").attr("transform", `translate(${margin.left},${margin.top})`);

            const x = d3.scaleBand()
                .domain(avgMathScoreByGender.map(d => d.gender))
                .rangeRound([0, width])
                .padding(0.1);

            const y = d3.scaleLinear()
                .domain([0, d3.max(avgMathScoreByGender, d => d.average)])
                .nice()
                .rangeRound([height, 0]);

            g.append("g")
                .selectAll(".bar")
                .data(avgMathScoreByGender)
                .enter().append("rect")
                .attr("class", "bar")
                .attr("x", d => x(d.gender))
                .attr("y", d => y(d.average))
                .attr("width", x.bandwidth())
                .attr("height", d => height - y(d.average));

            g.append("g")
                .attr("class", "axis axis--x")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x))
                .append("text")
                .attr("class", "axis-label")
                .attr("x", width / 2)
                .attr("y", margin.bottom - 10)
                .attr("fill", "#000")
                .text("Gender");

            g.append("g")
                .attr("class", "axis axis--y")
                .call(d3.axisLeft(y))
                .append("text")
                .attr("class", "axis-label")
                .attr("transform", "rotate(-90)")
                .attr("y", -margin.left + 10)
                .attr("dy", "0.71em")
                .attr("fill", "#000")
                .text("Score");
        });
    </script>

    <p class="center">Stuff</p>

    <br><br>

    <a href="scene2.html" style="text-decoration:none;"><button class="center">Next</button></a>
    <a href="index.html" style="text-decoration:none;"><button class="center"
            style="outline: 2px; outline-color: black; background-color: #0055BF; margin-bottom: 50px;">Back</button></a>

    <br><br><br>
    <div class="footer">
        <h4>Maxwell Wieboldt (mgw10)</h4>
        <h4>Dataset: https://www.kaggle.com/datasets/spscientist/students-performance-in-exams/data</h4>
    </div>

</body>

</html>